import{a as e,j as g,F as E}from"./emotion-react-jsx-runtime.browser.esm-afc7ad78.js";import{A as X,P as J}from"./AuthenticatedLayout-fd640e21.js";import{h as A,g as G,r as k,q as K,b as Q,c as V,a as tt}from"./app-8b3e4287.js";import{d as L,c as v}from"./DefaultThemeProvider-a3a1dc0a.js";import{e as B}from"./emotionCss-28d07aa7.js";import{d as H}from"./dayjs.min-a6621113.js";import{M as et,B as at,b as rt,T as N,F as it,I as nt,S as ot}from"./TextField-5ff06532.js";import{T as _}from"./Typography-7be4fd55.js";import{P as st}from"./Pagination-a513db1a.js";import{B as ct}from"./Button-d01e99ff.js";import{B as lt}from"./Box-2f6ab5a3.js";import{C as dt}from"./Container-257d708b.js";import{L as Z}from"./LoadingButton-504ee650.js";import{d as ut,T as ht,a as j,b as w,c as ft,e as mt}from"./TableRow-ea14acec.js";import{M as pt}from"./MenuItem-6e953c7a.js";import"./ApplicationLogo-e9c0f09a.js";import"./transition-082a77ae.js";import"./ButtonBase-38d11eb1.js";import"./useControlled-ce883e4c.js";import"./styled-a0985b3d.js";var R={exports:{}};(function(h,T){(function(l,y){h.exports=y()})(A,function(){var l={year:0,month:1,day:2,hour:3,minute:4,second:5},y={};return function($,M,i){var u,n=function(s,f,c){c===void 0&&(c={});var t=new Date(s),o=function(r,a){a===void 0&&(a={});var d=a.timeZoneName||"short",x=r+"|"+d,p=y[x];return p||(p=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:d}),y[x]=p),p}(f,c);return o.formatToParts(t)},m=function(s,f){for(var c=n(s,f),t=[],o=0;o<c.length;o+=1){var r=c[o],a=r.type,d=r.value,x=l[a];x>=0&&(t[x]=parseInt(d,10))}var p=t[3],z=p===24?0:p,C=t[0]+"-"+t[1]+"-"+t[2]+" "+z+":"+t[4]+":"+t[5]+":000",P=+s;return(i.utc(C).valueOf()-(P-=P%1e3))/6e4},D=M.prototype;D.tz=function(s,f){s===void 0&&(s=u);var c=this.utcOffset(),t=this.toDate(),o=t.toLocaleString("en-US",{timeZone:s}),r=Math.round((t-new Date(o))/1e3/60),a=i(o).$set("millisecond",this.$ms).utcOffset(15*-Math.round(t.getTimezoneOffset()/15)-r,!0);if(f){var d=a.utcOffset();a=a.add(c-d,"minute")}return a.$x.$timezone=s,a},D.offsetName=function(s){var f=this.$x.$timezone||i.tz.guess(),c=n(this.valueOf(),f,{timeZoneName:s}).find(function(t){return t.type.toLowerCase()==="timezonename"});return c&&c.value};var S=D.startOf;D.startOf=function(s,f){if(!this.$x||!this.$x.$timezone)return S.call(this,s,f);var c=i(this.format("YYYY-MM-DD HH:mm:ss:SSS"));return S.call(c,s,f).tz(this.$x.$timezone,!0)},i.tz=function(s,f,c){var t=c&&f,o=c||f||u,r=m(+i(),o);if(typeof s!="string")return i(s).tz(o);var a=function(z,C,P){var O=z-60*C*1e3,F=m(O,P);if(C===F)return[O,C];var Y=m(O-=60*(F-C)*1e3,P);return F===Y?[O,F]:[z-60*Math.min(F,Y)*1e3,Math.max(F,Y)]}(i.utc(s,t).valueOf(),r,o),d=a[0],x=a[1],p=i(d).utcOffset(x);return p.$x.$timezone=o,p},i.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},i.tz.setDefault=function(s){u=s}}})})(R);var gt=R.exports;const vt=G(gt);var W={exports:{}};(function(h,T){(function(l,y){h.exports=y()})(A,function(){var l="minute",y=/[+-]\d\d(?::?\d\d)?/g,$=/([+-]|\d\d)/g;return function(M,i,u){var n=i.prototype;u.utc=function(t){var o={date:t,utc:!0,args:arguments};return new i(o)},n.utc=function(t){var o=u(this.toDate(),{locale:this.$L,utc:!0});return t?o.add(this.utcOffset(),l):o},n.local=function(){return u(this.toDate(),{locale:this.$L,utc:!1})};var m=n.parse;n.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),m.call(this,t)};var D=n.init;n.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else D.call(this)};var S=n.utcOffset;n.utcOffset=function(t,o){var r=this.$utils().u;if(r(t))return this.$u?0:r(this.$offset)?S.call(this):this.$offset;if(typeof t=="string"&&(t=function(p){p===void 0&&(p="");var z=p.match(y);if(!z)return null;var C=(""+z[0]).match($)||["-",0,0],P=C[0],O=60*+C[1]+ +C[2];return O===0?0:P==="+"?O:-O}(t),t===null))return this;var a=Math.abs(t)<=16?60*t:t,d=this;if(o)return d.$offset=a,d.$u=t===0,d;if(t!==0){var x=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(d=this.local().add(a+x,l)).$offset=a,d.$x.$localOffset=x}else d=this.utc();return d};var s=n.format;n.format=function(t){var o=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return s.call(this,o)},n.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},n.isUTC=function(){return!!this.$u},n.toISOString=function(){return this.toDate().toISOString()},n.toString=function(){return this.toDate().toUTCString()};var f=n.toDate;n.toDate=function(t){return t==="s"&&this.$offset?u(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():f.call(this)};var c=n.diff;n.diff=function(t,o,r){if(t&&this.$u===t.$u)return c.call(this,t,o,r);var a=this.local(),d=u(t).local();return c.call(a,d,o,r)}}})})(W);var $t=W.exports;const xt=G($t);function bt(h){const T=h.openModal,l=h.setOpenModal,y=()=>l(!1),$=L().palette,M=L().breakpoints.values;h.formData;const i=h.setFormData,u=h.search,n=h.setSearch,m=h.searchCustomers;h.setSearchCustomers;const D=h.handleSearchCustomers,S=h.processing,s=h.page,f=h.setPage,c={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:M.md,height:"100vh",bgcolor:$.bg.color1,border:"2px solid ${palette.bg.color3}",boxShadow:24,p:4,overflowX:"bisible",overflowY:"auto"},t=(r,a)=>{f(d=>a),D(u,a)},o=r=>{i(a=>({...a,customer_id:r.id})),n(`id:${r.id} - ${r.name}（${r.kana}）`),l(!1)};return e("div",{children:e(et,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:T,onClose:y,closeAfterTransition:!0,slots:{backdrop:at},slotProps:{backdrop:{timeout:500}},children:e(rt,{in:T,children:g(lt,{sx:c,children:[e(_,{id:"transition-modal-title",variant:"h6",component:"h2",children:"顧客検索"}),g(_,{id:"transition-modal-description",sx:{mt:2},component:"table",css:v`
                        tr {
                            display:flex;
                            flex-direction: row;
                            align-items: center;
                            width: calc(${M.md}px - 68px - 20px);
                            border-bottom: 1px ${$.bg.color4} solid;
                        }
                        th, td {
                            width: calc( (100% - 100px) / 3 );
                            text-align:left;
                        }
                        th:nth-of-type(1),
                        td:nth-of-type(1) {
                            width: 100px;
                            text-align:right;
                            padding-right:16px;
                        }
                        th:nth-of-type(1) {
                            padding-right:32px;
                        }
                    `,children:[e("thead",{children:g("tr",{children:[e("th",{children:"ID"}),e("th",{children:"指名"}),e("th",{children:"カナ"}),e("th",{children:"電話番号"})]})}),e("tbody",{children:m.data.data.map((r,a)=>g("tr",{children:[e("td",{children:e("button",{css:v`
                                        padding: 8px 16px;
                                        border-radius: 6px;
                                        color: ${$.info.main};
                                        &:hover {
                                            color: ${$.info.light};
                                            background: ${$.info.dark};
                                        }
                                    `,onClick:d=>o(r),children:r.id})}),e("td",{children:r.name}),e("td",{children:r.kana}),e("td",{children:r.tel})]},a))})]}),e("div",{css:v`
                margin-top: 24px;
                    text-align:center;
                `,children:e(st,{css:v`
                            display: inline-block;
                            *, * * { color: ${$.text.primary} !important; }
                            button {
                                background: ${$.bg.color3};
                                &[aria-current="true"] {
                                    background: none;
                                    border: 1px ${$.bg.color5} solid;
                                }
                           }
                        `,count:m.data.last_page,page:s,onChange:t,disabled:S})}),e(ct,{variant:"contained",color:"secondary",onClick:r=>{l(!1)},children:"閉じる"})]})})})})}H.extend(xt);H.extend(vt);function Zt({auth:h,items:T}){const l=L().palette,y=L().breakpoints.values,[$,M]=k.useState(!1),[i,u]=k.useState(1),[n,m]=k.useState(!1),[D,S]=k.useState(!1),[s,f]=k.useState(!1),[c,t]=k.useState(""),[o,r]=k.useState({data:{data:[]}}),a=K().props.errors,[d,x]=k.useState({date:H().tz("Asia/Tokyo").format("YYYY-MM-DD"),customer_id:null,status:!0,items:[]}),[p,z]=k.useState(()=>T.map(b=>({...b,quantity:0}))),C=v`
        display: block;
        margin: 16px auto;
    `,P=({name:b,value:q})=>{x(I=>({...I,[b]:q}))},O=b=>{P(b.target),b.target.focus(),b.target.blur()},F=async(b,q)=>{m(!0),S(!0);const I=await Q.get(route("api.customers.search",{search:b,page:q}));r(I),M(!0),m(!1),S(!1)},Y=async b=>{m(!0),f(!0);const q=[];p.map(U=>{U.quantity>0&&q.push({id:U.id,quantity:U.quantity})});const I={...d,items:q};x(I),V.post(route("purchases.store"),I,{preserveStatel:!1,onError:()=>{m(!1),f(!1)}})};return g(E,{children:[g(X,{user:h.user,header:e("h2",{className:"font-semibold text-xl leading-tight",children:"購入画面"}),children:[e(tt,{title:"購入画面"}),a.article_ids&&e("div",{css:v`color:${l.error.main};`,children:a.article_ids}),e("div",{className:"py-12",children:e("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e("div",{className:"overflow-hidden shadow-sm sm:rounded-lg",css:v`background:${l.bg.color1};`,children:e("div",{className:"p-6",children:g(dt,{css:v`width:${y.sm}px;`,children:[e(N,{label:"購入日",type:"date",variant:"outlined",required:!0,css:B(l).textFieldDate,name:"date",value:d.date,onChange:b=>O(b)}),a.date&&e("div",{css:v`color:${l.error.main};`,children:a.date}),e(N,{label:"会員名（カナか電話番号を入力して「検索する」）",variant:"outlined",inputProps:{autoComplete:"off"},css:B(l).textField,name:"customer_info",value:c,onChange:b=>t(b.target.value)}),a.customer_id&&e("div",{css:v`color:${l.error.main};`,children:a.customer_id}),e(Z,{disabled:n,loading:D,variant:"contained",css:C,color:"secondary",onClick:b=>{u(1),F(c,1)},children:"検索する"}),e(yt,{items:T,textFieldCss:B(l).textField,buttonCss:C,palette:l,setFormData:x,itemList:p,setItemList:z,handleSubmit:Y}),a.items&&e("div",{css:v`color:${l.error.main};`,children:a.items}),a["items.0.id"]&&e("div",{css:v`color:${l.error.main};`,children:a["items.0.id"]}),a["items.0.quantity"]&&e("div",{css:v`color:${l.error.main};`,children:a["items.0.quantity"]}),e(Z,{disabled:n,loading:s,variant:"contained",css:C,color:"primary",onClick:Y,children:"購入する"})]})})})})})]}),e(bt,{openModal:$,setOpenModal:M,formData:d,setFormData:x,search:c,setSearch:t,searchCustomers:o,setSearchCustomers:r,handleSearchCustomers:F,page:i,setPage:u,processing:n,setProcessing:m})]})}function yt({palette:h,itemList:T,setItemList:l}){const[y,$]=k.useState(0),M=({id:i,quantity:u})=>{l(m=>m.map(S=>(i!==S.id||(S.quantity=u),S)));let n=0;T.map(m=>{n+=m.price*m.quantity}),$(n)};return g(E,{children:[e(mt,{component:J,css:v`
            margin-bottom: 48px;
        `,children:g(ut,{children:[e(ht,{children:g(j,{children:[e(w,{children:"id"}),e(w,{children:"商品名"}),e(w,{align:"right",children:"金額"}),e(w,{align:"right",children:"数量"}),e(w,{align:"right",children:"小計"})]})}),e(ft,{children:T.map(i=>g(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(w,{component:"th",scope:"row",children:i.id}),e(w,{children:i.name}),g(w,{align:"right",children:[i.price.toLocaleString()," 円"]}),e(w,{align:"right",children:g(it,{children:[e(nt,{}),e(ot,{id:i.id+"",value:i.quantity,label:"",onChange:u=>M({id:i.id,quantity:u.target.value}),children:[0,1,2,3,4,5,6,7,8,9].map(u=>g(pt,{value:u,children:[u," 個"]},u))})]})}),g(w,{align:"right",css:v`min-width:120px;`,children:[(i.price*i.quantity).toLocaleString()," 円"]})]},i.id))})]})}),g("div",{css:v`
            margin-bottom: 24px;
            text-align: center;
            background: ${h.bg.color2};
            padding: 8px;
            border-radius: 3px;
            border-bottom: 2px ${h.bg.color3} solid;
        `,children:["合計　",y.toLocaleString()," 円"]})]})}export{Zt as default};
